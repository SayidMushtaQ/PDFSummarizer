{% extends 'base.html' %}

{% block title %}{{ document.title }} - Summary{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h2 class="mb-4">{{ document.title }}</h2>
        
        <div class="row">
            <div class="col-md-6">
                <div class="card h-100">
                    <div class="card-header">
                        <h5 class="card-title mb-0">üìÑ Original Text (Preview)</h5>
                    </div>
                    <div class="card-body">
                        <div style="max-height: 400px; overflow-y: auto;">
                            <p class="card-text" style="white-space: pre-line; font-size: 0.9em;">
                                {{ summary.original_text|truncatewords:200 }}
                                {% if summary.original_text|wordcount > 200 %}
                                    <br><em>... (text truncated for display)</em>
                                {% endif %}
                            </p>
                        </div>
                        <hr>
                        <small class="text-muted">
                            Word count: {{ summary.original_text|wordcount }} words
                        </small>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card h-100">
                    <div class="card-header">
                        <h5 class="card-title mb-0">üìù AI-Generated Summary</h5>
                    </div>
                    <div class="card-body">
                        <p class="card-text" style="white-space: pre-line;">
                            {{ summary.summary_text }}
                        </p>
                        <hr>
                        <small class="text-muted">
                            Summary word count: {{ summary.summary_text|wordcount }} words<br>
                            Compression ratio: {% widthratio summary.summary_text|wordcount summary.original_text|wordcount 100 %}%
                        </small>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="mt-4">
            <div class="card">
                <div class="card-body">
                    <h6 class="card-title">Document Information</h6>
                    <div class="row">
                        <div class="col-md-6">
                            <p><strong>Uploaded:</strong> {{ document.uploaded_at|date:"F d, Y g:i A" }}</p>
                            <p><strong>Summary Created:</strong> {{ summary.created_at|date:"F d, Y g:i A" }}</p>
                        </div>
                        <div class="col-md-6">
                            <p><strong>Original File:</strong> {{ document.pdf_file.name|basename }}</p>
                            <p><strong>Processing Time:</strong> {{ summary.created_at|timesince:document.uploaded_at }}</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="mt-4">
            <a href="{% url 'upload_pdf' %}" class="btn btn-primary">Upload Another PDF</a>
            <a href="{% url 'document_list' %}" class="btn btn-outline-secondary">View All Documents</a>
        </div>
    </div>
</div>
{% endblock %}